<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/logger/index.js | architecture-node-base</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a href="https://bitbucket.org/naturacode/architecture-node-base">Repository</a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/app-settings.js~AppSettings.html">AppSettings</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/base-command.js~BaseCommand.html">BaseCommand</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#express">express</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/express/handler.js~ExpressHandler.html">ExpressHandler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-expressAppBuilder">expressAppBuilder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-corsmiddleware">corsmiddleware</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-handlertofunctionadapter">handlertofunctionadapter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-loggingMiddleware">loggingMiddleware</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#logger">logger</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/logger/index.js~Logger.html">Logger</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#tests">tests</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/tests/helpers.js~FakeCommand.html">FakeCommand</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-factory">factory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-asyncDone">asyncDone</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/logger/index.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">const _ = require(&apos;lodash&apos;);
const domain = require(&apos;domain&apos;);
const os = require(&apos;os&apos;);
const prettyjson = require(&apos;prettyjson&apos;);

/**
 * Default options for prettyjson
 */
const PrettyJsonDefaultOptions = Object.freeze({
  defaultIndentation: 4,
  inlineArrays: 1,
});

/**
 * Logger class implementing the recommended log structure
 * @example
 * const logger = new Logger({correlationId, sessionId});
 */
class Logger {
  /**
   * Initialize a Logger instance, using prettyjson when LOGS_PRETTY_PRINT is set
   * @param {Object} context - custom attributes to be logged
   */
  constructor(context) {
    /**
    * @type {object}
    */
    this.contextData = {
      context,
      name: process.env.APP_NAME,
    };

    if (process.env.LOGS_PRETTY_PRINT) {
      /**
      * @type {function}
      */
      this.format = (event) =&gt; {
        const header = `[${event.timestamp}]: [${event.message}]`;
        const eventDetails = _.omit(event, &apos;timestamp&apos;, &apos;message&apos;);
        const body =
          prettyjson
            .render(eventDetails, _.clone(PrettyJsonDefaultOptions))
            .replace(/\n/g, &apos;\n\t&apos;);

        return `\n${header}\n\t${body}\n\n`;
      };

      return;
    }

    this.format = event =&gt; JSON.stringify(event);
  }

  /**
   * Logs a message using stdout
   * @param {Object} message - the message to be logged
   * @param {Object} [additionalArguments] - object with additional info to be logged
   */
  log(message, additionalArguments = {}) {
    if (Logger.supressOutput) {
      return;
    }

    const event = this.logEvent(message, additionalArguments, &apos;info&apos;);
    process.stdout.write(this.format(event));
  }

  /**
   * @private
   */
  logEvent(message, additionalArguments) {
    return {
      ...additionalArguments,
      ...this.commonLogData(),
      ...this.contextData,
      message,
    };
  }

  /**
   * @private
   */
  commonLogData() {
    return {
      timestamp: new Date().toISOString(),
      uptime: os.uptime(),
    };
  }

  /**
   * Returns the current Logger instance in the active domain
   * or an instance without contextual information if there is no active domain.
   */
  static current() {
    if (!domain.active) {
      return Logger.nonContextualLogger;
    }

    return domain.active.logger;
  }
}

/**
 * @private
 */
Logger.nonContextualLogger = new Logger({});
/**
 * Suppress the logger output if set to true, * the main use case of this
 * property is hiding log messages for integration tests.
 */
Logger.supressOutput = false;

module.exports = Logger;
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
